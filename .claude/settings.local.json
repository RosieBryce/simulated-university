{
  "permissions": {
    "allow": [
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push)",
      "Bash(python -c:*)",
      "Bash(cd /c/Users/DELL/workspace/code/simulated-university && python << 'EOF'\nimport sys\nfrom pathlib import Path\nimport pandas as pd\nsys.path.insert\\(0, str\\(Path.cwd\\(\\)\\)\\)\nsys.path.insert\\(0, str\\(Path.cwd\\(\\) / 'supporting_systems'\\)\\)\n\nfrom core_systems.student_generation_pipeline import generate_students\nfrom core_systems.program_enrollment_system import ProgramEnrollmentSystem\nfrom core_systems.engagement_system import EngagementSystem\nfrom core_systems.assessment_system import AssessmentSystem\nfrom core_systems.progression_system import ProgressionSystem\n\n# Simulate Year 1 \\(1046-47\\)\nprint\\(\"=== YEAR 1 \\(1046-47\\) ===\\\\n\"\\)\n\nCOHORT_SIZE = 500\nyear_index = 0\nacademic_year = \"1046-47\"\nseed = 42\n\n# 1. Generate students\nprint\\(\"Step 1: Generate students\"\\)\nnew_students = generate_students\\(n=COHORT_SIZE, seed=seed\\)\nprint\\(f\"  Generated: {len\\(new_students\\)} students\"\\)\n\n# 2. Assign student_ids\nprint\\(\"\\\\nStep 2: Assign student_ids\"\\)\nnew_students_df = new_students.copy\\(\\)\noffset = year_index * COHORT_SIZE\nnew_students_df[\"student_id\"] = range\\(offset, offset + len\\(new_students_df\\)\\)\nprint\\(f\"  Assigned IDs: {offset} to {offset + len\\(new_students_df\\) - 1}\"\\)\n\n# 3. Enroll students\nprint\\(\"\\\\nStep 3: Enroll students\"\\)\nenrollment_sys = ProgramEnrollmentSystem\\(\\)\nstatus_change = \"1046-09-01\"\nenrolled_df = enrollment_sys.enroll_students_batch\\(\n    new_students_df,\n    academic_year=academic_year,\n    status_change_at=status_change,\n\\)\nprint\\(f\"  Enrolled: {len\\(enrolled_df\\)} students\"\\)\nprint\\(f\"  Student ID range: {enrolled_df['student_id'].min\\(\\)} to {enrolled_df['student_id'].max\\(\\)}\"\\)\n\n# 4. Generate engagement\nprint\\(\"\\\\nStep 4: Generate engagement data\"\\)\nengagement_sys = EngagementSystem\\(\\)\nenrolled_clean = enrolled_df.loc[:, ~enrolled_df.columns.duplicated\\(\\)]\nweekly_df, semester_df = engagement_sys.generate_engagement_data\\(\n    enrolled_clean, weeks_per_semester=12, academic_year=academic_year\n\\)\nweekly_df[\"academic_year\"] = academic_year\nprint\\(f\"  Weekly records: {len\\(weekly_df\\)}\"\\)\nprint\\(f\"  Unique students in weekly: {weekly_df['student_id'].nunique\\(\\)}\"\\)\n\n# 5. Generate assessment\nprint\\(\"\\\\nStep 5: Generate assessment data\"\\)\nassessment_sys = AssessmentSystem\\(seed=seed\\)\nassessment_df = assessment_sys.generate_assessment_data\\(\n    enrolled_clean,\n    academic_year=academic_year,\n    assessment_date=\"1047-05-15\",\n    weekly_engagement_path=\"\",  # No existing engagement yet\n\\)\nprint\\(f\"  Assessment records: {len\\(assessment_df\\)}\"\\)\nprint\\(f\"  Unique students in assessment: {assessment_df['student_id'].nunique\\(\\)}\"\\)\nprint\\(f\"  Student ID range: {assessment_df['student_id'].min\\(\\)} to {assessment_df['student_id'].max\\(\\)}\"\\)\n\n# Check for data loss\nassessment_students = set\\(assessment_df['student_id'].unique\\(\\)\\)\nenrolled_students = set\\(enrolled_df['student_id'].astype\\(str\\).unique\\(\\)\\)\nmissing = enrolled_students - assessment_students\nprint\\(f\"\\\\n  Students in enrolled but NOT in assessment: {len\\(missing\\)}\"\\)\nif len\\(missing\\) <= 10:\n    print\\(f\"    Missing: {sorted\\(list\\(missing\\)\\)[:10]}\"\\)\n\n# 6. Compute progression\nprint\\(\"\\\\nStep 6: Compute progression\"\\)\nprogression_sys = ProgressionSystem\\(seed=seed\\)\nprogression_df = progression_sys.compute_progression\\(\n    assessment_df,\n    enrolled_clean,\n    academic_year=academic_year,\n    status_change_at=\"1047-09-01\",\n\\)\nprint\\(f\"  Progression records: {len\\(progression_df\\)}\"\\)\nprint\\(f\"  Unique students in progression: {progression_df['student_id'].nunique\\(\\)}\"\\)\n\nEOF)",
      "Bash(cd /c/Users/DELL/workspace/code/simulated-university && python << 'EOF'\nimport sys\nfrom pathlib import Path\nimport pandas as pd\nsys.path.insert\\(0, str\\(Path.cwd\\(\\)\\)\\)\nsys.path.insert\\(0, str\\(Path.cwd\\(\\) / 'supporting_systems'\\)\\)\n\nfrom core_systems.student_generation_pipeline import generate_students\nfrom core_systems.program_enrollment_system import ProgramEnrollmentSystem\n\nCOHORT_SIZE = 500\nseed = 42\n\nnew_students = generate_students\\(n=COHORT_SIZE, seed=seed\\)\nyear_index = 0\nnew_students_df = new_students.copy\\(\\)\noffset = year_index * COHORT_SIZE\nnew_students_df[\"student_id\"] = range\\(offset, offset + len\\(new_students_df\\)\\)\n\nprint\\(\"Before enrollment:\"\\)\nprint\\(f\"  Rows: {len\\(new_students_df\\)}\"\\)\nprint\\(f\"  student_id dtype: {new_students_df['student_id'].dtype}\"\\)\nprint\\(f\"  student_id range: {new_students_df['student_id'].min\\(\\)} to {new_students_df['student_id'].max\\(\\)}\"\\)\nprint\\(f\"  First 10 student_ids: {new_students_df['student_id'].head\\(10\\).tolist\\(\\)}\"\\)\nprint\\(f\"  Last 10 student_ids: {new_students_df['student_id'].tail\\(10\\).tolist\\(\\)}\"\\)\n\nenrollment_sys = ProgramEnrollmentSystem\\(\\)\n\n# Manually step through enroll_students_batch\nenrollments = []\nfor idx, student in new_students_df.iterrows\\(\\):\n    sid_raw = student.get\\('student_id', idx\\)\n    sid = str\\(sid_raw.iloc[0]\\) if isinstance\\(sid_raw, pd.Series\\) else str\\(sid_raw\\)\n    \n    personality_cols = [col for col in new_students_df.columns if col.startswith\\('refined_'\\)]\n    motivation_cols = [col for col in new_students_df.columns if col.startswith\\('motivation_'\\)]\n    \n    personality = {col: student[col] for col in personality_cols}\n    motivation = {col: student[col] for col in motivation_cols}\n    \n    enrollment = enrollment_sys.enroll_student\\(\n        student_id=sid,\n        clan=student['clan'],\n        personality=personality,\n        motivation=motivation\n    \\)\n    \n    enrollments.append\\({\n        'student_id': enrollment.student_id,\n        'program_code': enrollment.program_code,\n    }\\)\n    \n    if idx < 3:\n        print\\(f\"\\\\nidx={idx}:\"\\)\n        print\\(f\"  sid_raw={sid_raw}, type={type\\(sid_raw\\)}\"\\)\n        print\\(f\"  sid={sid}\"\\)\n        print\\(f\"  enrollment.student_id={enrollment.student_id}, type={type\\(enrollment.student_id\\)}\"\\)\n\nenrollment_df = pd.DataFrame\\(enrollments\\)\nprint\\(f\"\\\\n\\\\nAfter creating enrollment_df:\"\\)\nprint\\(f\"  Rows: {len\\(enrollment_df\\)}\"\\)\nprint\\(f\"  student_id dtype: {enrollment_df['student_id'].dtype}\"\\)\nprint\\(f\"  student_id range: {enrollment_df['student_id'].min\\(\\)} to {enrollment_df['student_id'].max\\(\\)}\"\\)\nprint\\(f\"  First 10: {enrollment_df['student_id'].head\\(10\\).tolist\\(\\)}\"\\)\nprint\\(f\"  Last 10: {enrollment_df['student_id'].tail\\(10\\).tolist\\(\\)}\"\\)\n\nEOF)",
      "Bash(cd:*)"
    ]
  }
}
